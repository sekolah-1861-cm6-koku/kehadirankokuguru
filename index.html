<!doctype html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Kehadiran Kokurikulum SKBTHO 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #1a202c;
        }
        .content-wrapper { max-width: 450px; margin: 0 auto; }
        .main-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
        }
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 15px;
            background: #ffffff;
            font-size: 16px; /* Elak iPhone auto-zoom */
        }
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            cursor: pointer;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.2s;
        }
        .btn-info { background: #2563eb; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .status-box {
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="content-wrapper">
    <div class="main-card">
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-blue-900 leading-tight">Sistem Kehadiran Geofencing</h1>
            <p class="text-blue-600 font-medium mt-1">SK Bandar Tun Hussein Onn 2</p>
        </div>

        <div id="statusBanner" class="status-box bg-blue-50 text-blue-700 border border-blue-200">
            Sedia untuk mengesan lokasi
        </div>

        <div class="text-left mb-4">
            <label class="text-sm font-semibold text-gray-600 ml-1">Nama Penuh</label>
            <input type="text" id="teacherName" class="form-input" placeholder="Nama anda">
            
            <label class="text-sm font-semibold text-gray-600 ml-1">No. Pekerja / ID</label>
            <input type="text" id="teacherId" class="form-input" placeholder="ID anda">
        </div>

        <div id="locationData" class="hidden mb-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-500 text-left border border-gray-100">
            <p>Jarak: <span id="distVal" class="font-bold text-gray-800">-</span></p>
            <p>Status: <span id="locStatus" class="font-bold">-</span></p>
        </div>

        <button id="detectBtn" class="btn btn-info" onclick="detectLocation()">
            üìç Detect Lokasi Saya
        </button>
        
        <div class="flex gap-2">
            <button id="inBtn" class="btn btn-success" onclick="saveRecord('MASUK')" disabled>Masuk</button>
            <button id="outBtn" class="btn btn-danger" onclick="saveRecord('BALIK')" disabled>Balik</button>
        </div>
        
        <p class="mt-4 text-[10px] text-gray-400">Pastikan GPS aktif & gunakan Safari/Chrome</p>
    </div>
</div>

<script>
    // KOORDINAT SKBTHO 2
    const TARGET_LAT = 3.052485;
    const TARGET_LNG = 101.754269;
    const MAX_DISTANCE = 100; // Meter

    function detectLocation() {
        const banner = document.getElementById('statusBanner');
        banner.innerText = "‚è≥ Sedang mengesan GPS...";
        
        if (!navigator.geolocation) {
            alert("GPS tidak disokong oleh browser anda.");
            return;
        }

        // Setting High Accuracy untuk iPhone/Android
        const options = {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        };

        navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const dist = getDistance(TARGET_LAT, TARGET_LNG, lat, lng);
            
            document.getElementById('locationData').classList.remove('hidden');
            document.getElementById('distVal').innerText = Math.round(dist) + " meter";

            if (dist <= MAX_DISTANCE) {
                banner.innerText = "‚úÖ Lokasi Disahkan!";
                banner.className = "status-box bg-green-100 text-green-700 border border-green-300";
                document.getElementById('locStatus').innerText = "DALAM KAWASAN";
                document.getElementById('inBtn').disabled = false;
                document.getElementById('outBtn').disabled = false;
            } else {
                banner.innerText = "‚ùå Luar Kawasan Sekolah";
                banner.className = "status-box bg-red-100 text-red-700 border border-red-300";
                document.getElementById('locStatus').innerText = "LUAR KAWASAN";
                document.getElementById('inBtn').disabled = true;
                document.getElementById('outBtn').disabled = true;
            }
        }, (err) => {
            alert("Ralat GPS: Sila benarkan akses lokasi dalam tetapan telefon anda.");
            banner.innerText = "‚ö†Ô∏è Ralat Lokasi";
        }, options);
    }

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; 
        const d1 = lat1 * Math.PI/180;
        const d2 = lat2 * Math.PI/180;
        const df = (lat2-lat1) * Math.PI/180;
        const dl = (lon2-lon1) * Math.PI/180;
        const a = Math.sin(df/2) * Math.sin(df/2) +
                  Math.cos(d1) * Math.cos(d2) *
                  Math.sin(dl/2) * Math.sin(dl/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }

    function saveRecord(type) {
        const nama = document.getElementById('teacherName').value;
        if (!nama) return alert("Sila isi nama!");
        alert(`Berjaya! Rekod ${type} untuk ${nama} telah disimpan.`);
        // Reset form
        document.getElementById('teacherName').value = "";
        document.getElementById('teacherId').value = "";
        document.getElementById('inBtn').disabled = true;
        document.getElementById('outBtn').disabled = true;
    }
</script>

</body>
</html>
