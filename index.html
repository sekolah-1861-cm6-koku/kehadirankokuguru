<!doctype html>
<html lang="ms" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sistem Kehadiran SK Bandar Tun Hussein Onn 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #1a202c;
        }
        .content-wrapper { max-width: 500px; margin: 0 auto; }
        .header, .main-card {
            background: white;
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        .form-label { display: block; text-align: left; font-weight: 600; margin-bottom: 5px; color: #4a5568; }
        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #edf2f7;
            border-radius: 12px;
            margin-bottom: 15px;
            background: #f7fafc;
            outline: none;
        }
        .form-input:focus { border-color: #667eea; background: white; }
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-info { background: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .btn-primary { background: #10b981; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .btn-secondary { background: #ef4444; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        .btn:active { transform: scale(0.98); }
        .location-box {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #bae6fd;
            margin-bottom: 20px;
            text-align: left;
            font-size: 0.9rem;
        }
        #statusBanner { transition: all 0.5s ease; }
    </style>
</head>
<body>

<div class="content-wrapper">
    <header class="header">
        <h1 class="text-2xl font-bold text-gray-800">üìç Kehadiran Smart</h1>
        <p class="text-indigo-600 font-semibold">SK Desa Baiduri</p>
    </header>

    <div class="main-card">
        <div id="statusBanner" class="p-4 mb-5 rounded-xl bg-gray-100 text-gray-600 font-bold border-2 border-dashed border-gray-300">
            Sila Klik 'Detect Lokasi'
        </div>

        <div class="form-group text-left">
            <label class="form-label">Nama Penuh Guru</label>
            <input type="text" id="teacherName" class="form-input" placeholder="Masukkan Nama">
            
            <label class="form-label">ID / No. Pekerja</label>
            <input type="text" id="teacherId" class="form-input" placeholder="Masukkan ID">
        </div>

        <div id="locationDisplay" class="location-box" style="display:none">
            <div class="flex justify-between border-bottom pb-1">
                <span class="text-gray-500">Jarak Semasa:</span>
                <span id="distanceValue" class="font-bold text-blue-700">-</span>
            </div>
            <div class="flex justify-between pt-1">
                <span class="text-gray-500">Status Kawasan:</span>
                <span id="locationStatus" class="font-bold">-</span>
            </div>
        </div>

        <button id="detectBtn" class="btn btn-info" onclick="detectLocation()">
            <span>üì°</span> Detect Lokasi Saya
        </button>
        
        <div class="flex gap-3">
            <button id="checkinBtn" class="btn btn-primary" onclick="processAttendance('MASUK')" disabled>
                <span>‚úÖ</span> Masuk
            </button>
            <button id="checkoutBtn" class="btn btn-secondary" onclick="processAttendance('BALIK')" disabled>
                <span>üö™</span> Balik
            </button>
        </div>
    </div>
    
    <p class="text-center text-white text-xs opacity-70">Sila pastikan GPS telefon dihidupkan</p>
</div>

<script>
    // KOORDINAT SK DESA BAIDURI (Sesuai dengan permintaan anda)
    const SCHOOL_LAT = 3.052485; 
    const SCHOOL_LNG = 101.754269;
    const RADIUS_ALLOWED = 100; // Radius 100 meter

    let userLocation = null;

    function detectLocation() {
        const banner = document.getElementById('statusBanner');
        const detectBtn = document.getElementById('detectBtn');
        
        banner.innerHTML = "‚åõ Sedang mengesan GPS...";
        banner.className = "p-4 mb-5 rounded-xl bg-yellow-100 text-yellow-700 font-bold border-2 border-yellow-300";
        
        if (!navigator.geolocation) {
            alert("Maaf, pelayar anda tidak menyokong GPS.");
            return;
        }

        navigator.geolocation.getCurrentPosition((position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            userLocation = { lat, lng };

            const distance = calculateDistance(SCHOOL_LAT, SCHOOL_LNG, lat, lng);
            
            document.getElementById('locationDisplay').style.display = 'block';
            document.getElementById('distanceValue').innerText = Math.round(distance) + " meter";

            if (distance <= RADIUS_ALLOWED) {
                document.getElementById('locationStatus').innerText = "DALAM KAWASAN";
                document.getElementById('locationStatus').className = "font-bold text-green-600";
                
                banner.innerHTML = "‚úÖ Lokasi Disahkan!";
                banner.className = "p-4 mb-5 rounded-xl bg-green-100 text-green-700 font-bold border-2 border-green-500";
                
                document.getElementById('checkinBtn').disabled = false;
                document.getElementById('checkoutBtn').disabled = false;
            } else {
                document.getElementById('locationStatus').innerText = "LUAR KAWASAN";
                document.getElementById('locationStatus').className = "font-bold text-red-600";
                
                banner.innerHTML = "‚ùå Anda Di Luar Kawasan!";
                banner.className = "p-4 mb-5 rounded-xl bg-red-100 text-red-700 font-bold border-2 border-red-500";
                
                document.getElementById('checkinBtn').disabled = true;
                document.getElementById('checkoutBtn').disabled = true;
            }
        }, (err) => {
            banner.innerHTML = "‚ùå Gagal Mengesan Lokasi";
            banner.className = "p-4 mb-5 rounded-xl bg-red-100 text-red-700 font-bold border-2 border-red-500";
            alert("Sila benarkan akses lokasi pada peranti anda.");
        }, {
            enableHighAccuracy: true
        });
    }

    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371000; // Jejari bumi dalam meter
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }

    function processAttendance(type) {
        const nama = document.getElementById('teacherName').value;
        const id = document.getElementById('teacherId').value;
        
        if(!nama || !id) {
            alert("Sila lengkapkan Nama dan ID!");
            return;
        }

        const time = new Date().toLocaleTimeString();
        alert(`BERJAYA!\n\nNama: ${nama}\nStatus: ${type}\nMasa: ${time}\n\nData telah direkodkan.`);
        
        // Form reset selepas success
        document.getElementById('teacherName').value = "";
        document.getElementById('teacherId').value = "";
        document.getElementById('checkinBtn').disabled = true;
        document.getElementById('checkoutBtn').disabled = true;
    }
</script>

</body>
</html>


